{"id":"KnuA","dependencies":[{"name":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\HandshakeProtocol.js.map","includedInParent":true,"mtime":1606744555153},{"name":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\package.json","includedInParent":true,"mtime":1609144240016},{"name":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\package.json","includedInParent":true,"mtime":1606744555153},{"name":"./TextMessageFormat","loc":{"line":3,"column":34},"parent":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\HandshakeProtocol.js","resolved":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\TextMessageFormat.js"},{"name":"./Utils","loc":{"line":4,"column":30},"parent":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\HandshakeProtocol.js","resolved":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\Utils.js"},{"name":"buffer","parent":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\@microsoft\\signalr\\dist\\esm\\HandshakeProtocol.js","resolved":"D:\\work\\Rainmaker2\\Rainmaker2\\src\\Presentation\\libraries\\rainsoft-authorization\\node_modules\\buffer\\index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer;Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.HandshakeProtocol=void 0;var r=require(\"./TextMessageFormat\"),t=require(\"./Utils\"),o=function(){function o(){}return o.prototype.writeHandshakeRequest=function(e){return r.TextMessageFormat.write(JSON.stringify(e))},o.prototype.parseHandshakeResponse=function(o){var s,a;if((0,t.isArrayBuffer)(o)||void 0!==e&&o instanceof e){var n=new Uint8Array(o);if(-1===(f=n.indexOf(r.TextMessageFormat.RecordSeparatorCode)))throw new Error(\"Message is incomplete.\");var i=f+1;s=String.fromCharCode.apply(null,n.slice(0,i)),a=n.byteLength>i?n.slice(i).buffer:null}else{var f,u=o;if(-1===(f=u.indexOf(r.TextMessageFormat.RecordSeparator)))throw new Error(\"Message is incomplete.\");i=f+1;s=u.substring(0,i),a=u.length>i?u.substring(i):null}var p=r.TextMessageFormat.parse(s),l=JSON.parse(p[0]);if(l.type)throw new Error(\"Expected a handshake response from the server.\");return[a,l]},o}();exports.HandshakeProtocol=o;"},"sourceMaps":{"js":{"mappings":[{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":0}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":4}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":6}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":14}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":24}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":31}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":38}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":53}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":61}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":74}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":75}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":82}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":86}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":94}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":117}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":2,"column":119}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":2,"column":123}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":2,"column":125}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":2,"column":133}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":2,"column":156}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":2,"column":158}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":2,"column":166}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":177}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":179}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":190}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":199}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":2,"column":204}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":2,"column":211}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":2,"column":213}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":2,"column":223}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":22,"column":4},"generated":{"line":2,"column":245}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":22,"column":33},"generated":{"line":2,"column":254}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":15},"generated":{"line":2,"column":257}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":15},"generated":{"line":2,"column":264}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":33},"generated":{"line":2,"column":266}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":33},"generated":{"line":2,"column":284}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":39},"generated":{"line":2,"column":290}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":44},"generated":{"line":2,"column":295}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":23,"column":54},"generated":{"line":2,"column":305}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":26,"column":11},"generated":{"line":2,"column":310}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":26,"column":11},"generated":{"line":2,"column":312}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":26,"column":11},"generated":{"line":2,"column":322}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":26,"column":4},"generated":{"line":2,"column":345}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":26,"column":34},"generated":{"line":2,"column":354}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":27,"column":12},"generated":{"line":2,"column":357}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":28,"column":12},"generated":{"line":2,"column":361}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":29,"column":12},"generated":{"line":2,"column":363}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":2,"column":365}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":2,"column":369}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":26},"generated":{"line":2,"column":371}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":26},"generated":{"line":2,"column":373}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":26},"generated":{"line":2,"column":388}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":54},"generated":{"line":2,"column":397}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":43},"generated":{"line":2,"column":401}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":69},"generated":{"line":2,"column":404}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":85},"generated":{"line":2,"column":417}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":31,"column":94},"generated":{"line":2,"column":419}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":33,"column":18},"generated":{"line":2,"column":420}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":33,"column":18},"generated":{"line":2,"column":424}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":33,"column":31},"generated":{"line":2,"column":426}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":33,"column":35},"generated":{"line":2,"column":430}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":33,"column":46},"generated":{"line":2,"column":441}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":35,"column":16},"generated":{"line":2,"column":444}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":35,"column":36},"generated":{"line":2,"column":448}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":18},"generated":{"line":2,"column":453}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":35},"generated":{"line":2,"column":455}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":46},"generated":{"line":2,"column":457}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":54},"generated":{"line":2,"column":465}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":72},"generated":{"line":2,"column":467}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":34,"column":72},"generated":{"line":2,"column":485}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":36,"column":22},"generated":{"line":2,"column":507}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":36,"column":22},"generated":{"line":2,"column":513}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":36,"column":26},"generated":{"line":2,"column":517}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":36,"column":32},"generated":{"line":2,"column":523}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":41,"column":18},"generated":{"line":2,"column":549}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":41,"column":18},"generated":{"line":2,"column":553}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":41,"column":35},"generated":{"line":2,"column":555}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":41,"column":52},"generated":{"line":2,"column":557}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":12},"generated":{"line":2,"column":559}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":26},"generated":{"line":2,"column":561}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":33},"generated":{"line":2,"column":568}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":46},"generated":{"line":2,"column":581}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":52},"generated":{"line":2,"column":587}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":58},"generated":{"line":2,"column":592}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":69},"generated":{"line":2,"column":594}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":75},"generated":{"line":2,"column":600}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":42,"column":78},"generated":{"line":2,"column":602}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":12},"generated":{"line":2,"column":606}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":29},"generated":{"line":2,"column":608}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":40},"generated":{"line":2,"column":610}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":53},"generated":{"line":2,"column":621}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":71},"generated":{"line":2,"column":623}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":82},"generated":{"line":2,"column":625}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":88},"generated":{"line":2,"column":631}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":104},"generated":{"line":2,"column":634}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":43,"column":113},"generated":{"line":2,"column":641}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":44,"column":15},"generated":{"line":2,"column":650}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":45,"column":18},"generated":{"line":2,"column":651}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":18},"generated":{"line":2,"column":655}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":45,"column":18},"generated":{"line":2,"column":657}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":45,"column":37},"generated":{"line":2,"column":659}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":47,"column":16},"generated":{"line":2,"column":661}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":47,"column":36},"generated":{"line":2,"column":665}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":18},"generated":{"line":2,"column":670}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":35},"generated":{"line":2,"column":672}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":44},"generated":{"line":2,"column":674}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":52},"generated":{"line":2,"column":682}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":70},"generated":{"line":2,"column":684}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":46,"column":70},"generated":{"line":2,"column":702}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":48,"column":22},"generated":{"line":2,"column":720}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":48,"column":22},"generated":{"line":2,"column":726}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":48,"column":26},"generated":{"line":2,"column":730}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":48,"column":32},"generated":{"line":2,"column":736}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":53,"column":18},"generated":{"line":2,"column":762}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":53,"column":35},"generated":{"line":2,"column":764}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":53,"column":52},"generated":{"line":2,"column":766}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":54,"column":12},"generated":{"line":2,"column":768}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":54,"column":26},"generated":{"line":2,"column":770}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":54,"column":35},"generated":{"line":2,"column":772}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":54,"column":45},"generated":{"line":2,"column":782}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":54,"column":48},"generated":{"line":2,"column":784}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":12},"generated":{"line":2,"column":787}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":29},"generated":{"line":2,"column":789}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":38},"generated":{"line":2,"column":791}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":47},"generated":{"line":2,"column":798}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":65},"generated":{"line":2,"column":800}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":74},"generated":{"line":2,"column":802}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":84},"generated":{"line":2,"column":812}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":55,"column":102},"generated":{"line":2,"column":815}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":14},"generated":{"line":2,"column":820}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":14},"generated":{"line":2,"column":824}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":25},"generated":{"line":2,"column":826}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":43},"generated":{"line":2,"column":828}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":43},"generated":{"line":2,"column":846}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":59,"column":49},"generated":{"line":2,"column":852}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":60,"column":14},"generated":{"line":2,"column":855}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":60,"column":25},"generated":{"line":2,"column":857}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":60,"column":30},"generated":{"line":2,"column":862}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":60,"column":36},"generated":{"line":2,"column":868}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":60,"column":45},"generated":{"line":2,"column":870}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":61,"column":12},"generated":{"line":2,"column":874}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":61,"column":12},"generated":{"line":2,"column":877}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":61,"column":21},"generated":{"line":2,"column":879}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":62,"column":18},"generated":{"line":2,"column":884}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":62,"column":18},"generated":{"line":2,"column":890}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":62,"column":22},"generated":{"line":2,"column":894}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":62,"column":28},"generated":{"line":2,"column":900}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":68,"column":15},"generated":{"line":2,"column":950}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":68,"column":15},"generated":{"line":2,"column":956}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":68,"column":16},"generated":{"line":2,"column":957}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":64,"column":26},"generated":{"line":2,"column":959}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":2,"column":963}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":965}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":968}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":976}},{"source":"../../src/HandshakeProtocol.ts","name":null,"original":{"line":20,"column":0},"generated":{"line":2,"column":994}}],"sources":{"../../src/HandshakeProtocol.ts":"// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n\r\n/** @private */\r\nexport interface HandshakeRequestMessage {\r\n    readonly protocol: string;\r\n    readonly version: number;\r\n}\r\n\r\n/** @private */\r\nexport interface HandshakeResponseMessage {\r\n    readonly error: string;\r\n    readonly minorVersion: number;\r\n}\r\n\r\n/** @private */\r\nexport class HandshakeProtocol {\r\n    // Handshake request is always JSON\r\n    public writeHandshakeRequest(handshakeRequest: HandshakeRequestMessage): string {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    }\r\n\r\n    public parseHandshakeResponse(data: any): [any, HandshakeResponseMessage] {\r\n        let responseMessage: HandshakeResponseMessage;\r\n        let messageData: string;\r\n        let remainingData: any;\r\n\r\n        if (isArrayBuffer(data) || (typeof Buffer !== \"undefined\" && data instanceof Buffer)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            const binaryData = new Uint8Array(data);\r\n            const separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        } else {\r\n            const textData: string = data;\r\n            const separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n\r\n        // At this point we should have just the single handshake message\r\n        const messages = TextMessageFormat.parse(messageData);\r\n        const response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        responseMessage = response;\r\n\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    }\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"adcb4d4d77e9c9dddb26eb23ba270ced","cacheData":{"env":{}}}